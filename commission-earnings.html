<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commission Earnings | DeadStock Exchange Seller Center</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #27ae60;
            --light: #f4f7f6;
            --dark: #333;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #3498db;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 50%, #16213e 100%);
            color: var(--dark);
            min-height: 100vh;
        }

        header {
            background: var(--primary);
            color: white;
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .logo span { color: var(--accent); }

        .header-right {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .btn {
            background: var(--accent);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: 0.3s;
        }

        .btn:hover { background: #229954; }

        .btn-danger {
            background: var(--danger);
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .btn-danger:hover { background: #c0392b; }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-header {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .page-header h1 {
            margin: 0 0 10px 0;
            color: var(--primary);
        }

        .page-header p {
            margin: 0;
            color: #666;
        }

        .earnings-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .earnings-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid var(--accent);
        }

        .earnings-card.pending {
            border-left-color: var(--warning);
        }

        .earnings-card.processing {
            border-left-color: var(--info);
        }

        .card-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .card-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .card-subtext {
            font-size: 0.85rem;
            color: #999;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }

        .tab-btn {
            padding: 12px 20px;
            background: var(--light);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--dark);
            transition: 0.3s;
        }

        .tab-btn.active {
            background: var(--accent);
            color: white;
        }

        .tab-btn:hover {
            background: var(--accent);
            color: white;
        }

        .earnings-table {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: var(--light);
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-processing {
            background: #cce5ff;
            color: #004085;
        }

        .commission-breakdown {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .breakdown-item:last-child {
            border-bottom: none;
        }

        .breakdown-item.total {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--primary);
            padding-top: 20px;
            border-top: 2px solid var(--accent);
        }

        .breakdown-label {
            color: #666;
        }

        .breakdown-value {
            font-weight: 600;
            color: var(--dark);
        }

        .export-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            display: flex;
            gap: 10px;
            margin-bottom: 40px;
        }

        .date-range {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }

        .date-range input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95rem;
        }

        .commission-info {
            background: #e3f2fd;
            border-left: 4px solid var(--info);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .commission-info h3 {
            margin-top: 0;
            color: var(--info);
        }

        .commission-rates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .rate-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .rate-card h4 {
            margin: 0 0 10px 0;
            color: var(--primary);
        }

        .rate-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent);
        }

        .rate-description {
            font-size: 0.85rem;
            color: #666;
            margin-top: 10px;
        }

        .payout-button {
            background: var(--success);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
        }

        .payout-button:hover {
            background: #229954;
        }

        .payout-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .earnings-cards {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            table {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">Dead<span>Stock</span> Exchange - Seller Center</div>
        <div class="header-right">
            <div style="color: white;">
                <span id="userEmail">Seller</span>
            </div>
            <button class="btn btn-danger" onclick="logout()">Logout</button>
        </div>
    </header>

    <div class="container">
        <div class="page-header">
            <h1>ðŸ’° Commission & Earnings Dashboard</h1>
            <p>Track your sales, commissions, and payouts in real-time</p>
        </div>

        <div class="earnings-cards">
            <div class="earnings-card">
                <div class="card-label">Total Gross Sales</div>
                <div class="card-value" id="totalSales">$0.00</div>
                <div class="card-subtext">All-time sales (this month)</div>
            </div>
            <div class="earnings-card">
                <div class="card-label">Commission Earned</div>
                <div class="card-value" id="totalCommission" style="color: var(--warning);">$0.00</div>
                <div class="card-subtext">8% of sales + 1% processing</div>
            </div>
            <div class="earnings-card pending">
                <div class="card-label">Pending Payout</div>
                <div class="card-value" id="pendingPayout" style="color: var(--warning);">$0.00</div>
                <div class="card-subtext">Awaiting processing</div>
            </div>
            <div class="earnings-card processing">
                <div class="card-label">Net Earnings</div>
                <div class="card-value" id="netEarnings" style="color: var(--info);">$0.00</div>
                <div class="card-subtext">Sales minus commissions</div>
            </div>
        </div>

        <div class="commission-info">
            <h3>ðŸ“Š Commission Structure</h3>
            <div class="commission-rates">
                <div class="rate-card">
                    <h4>Platform Commission</h4>
                    <div class="rate-value">8%</div>
                    <div class="rate-description">Charged on all sales for marketplace services</div>
                </div>
                <div class="rate-card">
                    <h4>Processing Fee</h4>
                    <div class="rate-value">1%</div>
                    <div class="rate-description">Payment processing and handling</div>
                </div>
                <div class="rate-card">
                    <h4>Total Fees</h4>
                    <div class="rate-value">9%</div>
                    <div class="rate-description">Combined deduction from sales</div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('earnings-history')">ðŸ“‹ Earnings History</button>
            <button class="tab-btn" onclick="switchTab('payout-history')">ðŸ’³ Payout History</button>
            <button class="tab-btn" onclick="switchTab('breakdown')">ðŸ“Š Commission Breakdown</button>
        </div>

        <!-- EARNINGS HISTORY TAB -->
        <div id="earnings-history" class="tab-content" style="display: block;">
            <div style="margin-bottom: 20px;">
                <div class="date-range">
                    <label>Filter by Date:</label>
                    <input type="date" id="startDate">
                    <span>to</span>
                    <input type="date" id="endDate">
                    <button class="btn" onclick="filterEarnings()">Filter</button>
                </div>
            </div>

            <div class="earnings-table">
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Sale ID</th>
                            <th>Gross Sales</th>
                            <th>Commission (8%)</th>
                            <th>Processing (1%)</th>
                            <th>Net Earnings</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="earningsTableBody">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #999; padding: 40px;">No sales data available</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- PAYOUT HISTORY TAB -->
        <div id="payout-history" class="tab-content" style="display: none;">
            <div style="margin-bottom: 20px;">
                <button class="payout-button" id="requestPayoutBtn" onclick="requestPayout()">ðŸ’¸ Request Payout</button>
            </div>

            <div class="earnings-table">
                <table>
                    <thead>
                        <tr>
                            <th>Payout Date</th>
                            <th>Payout ID</th>
                            <th>Amount</th>
                            <th>Method</th>
                            <th>Status</th>
                            <th>Expected Delivery</th>
                        </tr>
                    </thead>
                    <tbody id="payoutTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #999; padding: 40px;">No payout history</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- COMMISSION BREAKDOWN TAB -->
        <div id="breakdown" class="tab-content" style="display: none;">
            <div class="commission-breakdown">
                <h3>Monthly Commission Summary</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">Total Sales Volume</span>
                    <span class="breakdown-value" id="summaryTotalSales">$0.00</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Platform Commission (8%)</span>
                    <span class="breakdown-value" id="summaryCommission">$0.00</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Processing Fee (1%)</span>
                    <span class="breakdown-value" id="summaryProcessing">$0.00</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">GST/HST (Applicable)</span>
                    <span class="breakdown-value" id="summaryTax">$0.00</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">Refunds / Chargebacks</span>
                    <span class="breakdown-value" id="summaryRefunds">$0.00</span>
                </div>
                <div class="breakdown-item total">
                    <span class="breakdown-label">Total Deductions</span>
                    <span class="breakdown-value" id="summaryDeductions">$0.00</span>
                </div>
                <div class="breakdown-item total">
                    <span class="breakdown-label">Net Amount to You</span>
                    <span class="breakdown-value" id="summaryNetAmount">$0.00</span>
                </div>
            </div>

            <div class="export-section">
                <button class="btn" onclick="downloadReport()">ðŸ“¥ Download Report (PDF)</button>
                <button class="btn" onclick="downloadReport('csv')">ðŸ“Š Download CSV</button>
                <button class="btn" onclick="emailReport()">ðŸ“§ Email Report</button>
            </div>
        </div>
    </div>

    <script>
        const PLATFORM_COMMISSION = 0.08; // 8%
        const PROCESSING_FEE = 0.01; // 1%

        document.addEventListener('DOMContentLoaded', () => {
            checkSession();
            loadEarnings();
        });

        function checkSession() {
            const sellerSession = localStorage.getItem('sellerSession');
            if (!sellerSession) {
                window.location.href = 'seller-login.html';
                return;
            }
            try {
                const session = JSON.parse(sellerSession);
                document.getElementById('userEmail').textContent = session.email || 'Seller';
            } catch(e) {
                document.getElementById('userEmail').textContent = 'Seller';
            }
        }

        function loadEarnings() {
            const commissions = JSON.parse(localStorage.getItem('commissions') || '[]');
            let totalSales = 0, totalCommission = 0, totalProcessing = 0;
            let pendingPayouts = 0;

            // Populate earnings history table
            const tableBody = document.getElementById('earningsTableBody');
            if (commissions.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #999; padding: 40px;">No sales data available</td></tr>';
            } else {
                tableBody.innerHTML = commissions.map(c => {
                    totalSales += c.grossSales;
                    totalCommission += c.commission;
                    totalProcessing += c.processing;
                    if (c.status === 'Pending') pendingPayouts += c.netPayout;
                    
                    return `
                        <tr>
                            <td>${c.date}</td>
                            <td><strong>${c.id}</strong></td>
                            <td>$${c.grossSales.toFixed(2)}</td>
                            <td>-$${c.commission.toFixed(2)}</td>
                            <td>-$${c.processing.toFixed(2)}</td>
                            <td><strong>$${c.netPayout.toFixed(2)}</strong></td>
                            <td><span class="status-badge status-${c.status.toLowerCase()}">${c.status}</span></td>
                        </tr>
                    `;
                }).join('');
            }

            // Update cards
            const netEarnings = totalSales - totalCommission - totalProcessing;
            document.getElementById('totalSales').textContent = '$' + totalSales.toFixed(2);
            document.getElementById('totalCommission').textContent = '$' + (totalCommission + totalProcessing).toFixed(2);
            document.getElementById('netEarnings').textContent = '$' + netEarnings.toFixed(2);
            document.getElementById('pendingPayout').textContent = '$' + pendingPayouts.toFixed(2);

            // Update breakdown summary
            document.getElementById('summaryTotalSales').textContent = '$' + totalSales.toFixed(2);
            document.getElementById('summaryCommission').textContent = '$' + totalCommission.toFixed(2);
            document.getElementById('summaryProcessing').textContent = '$' + totalProcessing.toFixed(2);
            document.getElementById('summaryDeductions').textContent = '$' + (totalCommission + totalProcessing).toFixed(2);
            document.getElementById('summaryNetAmount').textContent = '$' + netEarnings.toFixed(2);

            // Load payout history
            loadPayoutHistory();
        }

        function loadPayoutHistory() {
            const payouts = JSON.parse(localStorage.getItem('payouts') || '[]');
            const tableBody = document.getElementById('payoutTableBody');
            
            if (payouts.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #999; padding: 40px;">No payout history</td></tr>';
            } else {
                tableBody.innerHTML = payouts.map(p => `
                    <tr>
                        <td>${p.date}</td>
                        <td><strong>${p.id}</strong></td>
                        <td>$${p.amount.toFixed(2)}</td>
                        <td>${p.method}</td>
                        <td><span class="status-badge status-${p.status.toLowerCase()}">${p.status}</span></td>
                        <td>${p.expectedDate || 'N/A'}</td>
                    </tr>
                `).join('');
            }
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabId).style.display = 'block';
            event.target.classList.add('active');
        }

        function requestPayout() {
            const commissions = JSON.parse(localStorage.getItem('commissions') || '[]');
            const pendingTotal = commissions
                .filter(c => c.status === 'Pending')
                .reduce((sum, c) => sum + c.netPayout, 0);
            
            if (pendingTotal === 0) {
                alert('No pending funds available for payout');
                return;
            }

            const payout = {
                id: 'PAYOUT-' + Date.now(),
                amount: pendingTotal,
                method: 'Bank Transfer',
                date: new Date().toLocaleDateString(),
                status: 'Processing',
                expectedDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toLocaleDateString()
            };

            let payouts = JSON.parse(localStorage.getItem('payouts') || '[]');
            payouts.push(payout);
            localStorage.setItem('payouts', JSON.stringify(payouts));

            // Mark commissions as paid
            commissions.forEach(c => {
                if (c.status === 'Pending') c.status = 'Paid';
            });
            localStorage.setItem('commissions', JSON.stringify(commissions));

            alert('âœ… Payout request submitted! Expected delivery in 1-2 business days.');
            loadEarnings();
        }

        function filterEarnings() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            console.log('Filtering from', startDate, 'to', endDate);
            alert('Filter feature coming soon!');
        }

        function downloadReport() {
            alert('Report download coming soon!');
        }

        function emailReport() {
            const email = JSON.parse(localStorage.getItem('sellerSession')).email;
            alert('Report will be sent to ' + email);
        }

        function logout() {
            localStorage.removeItem('sellerSession');
            window.location.href = 'logout.html';
        }
    </script>
</body>
</html>
